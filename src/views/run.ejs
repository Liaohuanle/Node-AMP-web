
<script type="text/javascript" src="/act/assets/js/jquery.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick.min.js"></script>
<script>
  const timeNode = <%- setIntervalTimeNode %>
  const YTP= <%- YTvideoinfo %>
  const ajaxUrl= "<%- ajaxUrl %>"
  const restTime = timeNode.restTime
  const winWidth = $(window).width()
  const winHeight = $(window).height()
  $(function(){
    initTime(...restTime)
    countDownTime()
    slideInit()
    initScroll()
    transformBanner()
    initBanner()
    initRule()
  })

  function initTermOfUse(){
    $('#getTermOfUse').on('click',function(){
      $.ajax({
        url: '/act/India/termofuse'
      }).done(appendTerm)
    })
  }

  function initRule(){
    $('#ruleClick').on('click',function(){
      $.ajax({
        url: '/act/India/rules'
      }).done(appendTerm)
    })
  }

  function appendTerm(res){
    $('#section-container')
    .addClass('section-container-show')
    .html(res)
    $('body').addClass('overflow-y-hidden')
    $('.close').click(function(){
      $('#section-container').removeClass('section-container-show')
      $('body').removeClass('overflow-y-hidden')
    })
  }

  function initBanner(){
    setTimeout(function(){
      $('.banner-image').addClass('banner-image-show')
      getREST()
    }, 800)
  }

  function slideInit(){
    $(".slider").slick({
      infinite: true,
      dots: false,
      slidesToShow: 1,
      autoplaySpeed: 2000,
      slidesToScroll: 1,
      pauseOnDotsHover: true,
      appendArrows: false,
      cssEase: 'linear',
      mobileFirst: true,
      initialSlide: timeNode.currentStep
    })
  }

  function initTime(day, hour, min, sec){
    $('.days span').html(day < 10 ? `0${day}`: day)
    $('.hours span').html(hour < 10 ? `0${hour}`: hour)
    $('.minutes span').html(min < 10 ? `0${min}`: min)
    $('.seconds span').html(sec < 10 ? `0${sec}`: sec)
  }

  function countDownTime(){
    let sec = restTime[3]
    let min = restTime[2]
    let hour = restTime[1]
    let day = restTime[0]
    setInterval(function(){
      sec--
      if( sec <= 0 ){
        sec = 59
        min--
        if(min <= 0){
          min = 59
          hour--
          if(hour <= 0){
            hour = 23
            day--
            if( day <= 0){
              day = 0
            }
          }
        }
      }
      initTime(day, hour, min, sec)
    }, 1000)
  }

  function getREST(){
    $.ajax({
      url: ajaxUrl
    }).done(function(res) {
      $('.main-container').append(res)
      $('.subItem').click(function(){
        $(".slider").slick('slickGoTo', $(this).index())
      })
      $("#slick-meet").slick({
        pauseOnHover: true,
        pauseOnFocus: true,
        autoplay: true,
        infinite: true,
        dots: true,
        slidesToShow: window.outerHeight <= 812 ? 1 : 3,
        autoplaySpeed: 2000,
        slidesToScroll: window.outerHeight <= 812 ? 1 : 3,
        pauseOnDotsHover: true,
        appendArrows: false,
        mobileFirst: true
      })
      $('#media iframe').width(winWidth)
      $('#media iframe').height(winWidth * YTP.proportion)
      initTermOfUse()
    })
  }

  function initScroll(){
    window.onscroll = function(e) {
      $('.ampstart-headerbar').removeClass('theme-red-nav')
      $('.banner-mask video').attr('style', 'display: block')
      if(window.scrollY && winWidth > 769 && window.scrollY > winHeight) {
        $('.ampstart-headerbar').addClass('theme-red-nav')
        $('.banner-mask video').attr('style', 'display: none')
      }
    }
  }

  function transformBanner(){
    if(justifiy.IsSafari()){
      $('.banner-mask video').remove();
      // $('.banner-mask img')
      // .attr('src', '/act/assets/pc-banner-bg.png')
      // .attr('style', 'display: block');
    }
  }

  var justifiy = {
    isWeixinBrowser: function(){
      return /micromessenger/.test(navigator.userAgent.toLowerCase())
    },
    isAndroid: function(){
      return (/android/i).test(navigator.userAgent)
    },
    IsSafari: function() {
      return navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1
    }
  }

</script>